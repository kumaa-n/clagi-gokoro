<% breadcrumb :new_song %>
<%= content_for(:title, t(".title")) %>

<div class="flex-1 bg-base-200/50">
  <div class="pt-4 md:pt-6 mb-6">
    <div class="container mx-auto px-4">
      <%= render "shared/breadcrumbs" %>
    </div>
  </div>

  <div class="container mx-auto max-w-lg px-4 pb-8 md:pb-12 lg:pb-16">
    <div class="p-8 md:p-12 rounded-2xl w-full bg-white">
    <h2 class="text-3xl md:text-4xl font-serif font-medium text-center mb-8 md:mb-10 text-primary tracking-wide">
      新しい曲を追加
    </h2>

    <%= form_with model: @song, class: "space-y-2", data: {
      controller: "duplicate-checker",
      duplicate_checker_url_value: check_duplicate_songs_path,
    } do |f| %>
      <%= render "shared/error_message", object: f.object %>

      <%# 重複警告エリア %>
      <div data-duplicate-checker-target="warning" class="hidden mb-8"></div>

      <div class="relative"
           data-controller="char-counter autocomplete"
           data-char-counter-min-value=1
           data-char-counter-max-value=<%= Song::TITLE_MAX_LENGTH %>
           data-autocomplete-url-value="<%= autocomplete_songs_path %>"
           data-autocomplete-field-value="title">
        <%= f.label :title, class: "font-serif font-medium text-primary text-base mb-2" %>
        <span class="text-xs text-error font-medium">*</span>
        <%= f.text_field :title, placeholder: "曲名を入力",
              class: "input input-bordered w-full bg-base-100/50 focus:bg-white",
              autocomplete: "off",
              data: {
                char_counter_target: "input",
                duplicate_checker_target: "title",
                autocomplete_target: "input",
                action: "input->char-counter#updateCount input->duplicate-checker#checkDuplicate input->autocomplete#onInput blur->autocomplete#onBlur keydown->autocomplete#onKeydown focus->char-counter#markAsTouched"
              } %>
        <ul class="absolute z-10 w-full bg-white border border-base-200 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto hidden"
            data-autocomplete-target="results"></ul>
        <div class="text-right text-sm text-neutral/60 mt-1">
          <span data-char-counter-target="counter">0</span> / <%= Song::TITLE_MAX_LENGTH %>文字
        </div>
      </div>

      <div class="relative"
           data-controller="char-counter autocomplete"
           data-char-counter-max-value=<%= Song::COMPOSER_MAX_LENGTH %>
           data-autocomplete-url-value="<%= autocomplete_songs_path %>"
           data-autocomplete-field-value="composer">
        <%= f.label :composer, class: "font-serif font-medium text-primary text-base mb-2" %>
        <%= f.text_field :composer, placeholder: "作曲者を入力",
              class: "input input-bordered w-full bg-base-100/50 focus:bg-white",
              autocomplete: "off",
              data: {
                char_counter_target: "input",
                duplicate_checker_target: "composer",
                autocomplete_target: "input",
                action: "input->char-counter#updateCount input->duplicate-checker#checkDuplicate input->autocomplete#onInput blur->autocomplete#onBlur keydown->autocomplete#onKeydown focus->char-counter#markAsTouched"
              } %>
        <ul class="absolute z-10 w-full bg-white border border-base-200 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto hidden"
            data-autocomplete-target="results"></ul>
        <div class="text-right text-sm text-neutral/60 mt-1">
          <span data-char-counter-target="counter">0</span> / <%= Song::COMPOSER_MAX_LENGTH %>文字
        </div>
      </div>

      <div class="relative"
           data-controller="char-counter autocomplete"
           data-char-counter-max-value=<%= Song::ARRANGER_MAX_LENGTH %>
           data-autocomplete-url-value="<%= autocomplete_songs_path %>"
           data-autocomplete-field-value="arranger">
        <%= f.label :arranger, class: "font-serif font-medium text-primary text-base mb-2" %>
        <%= f.text_field :arranger, placeholder: "編曲者を入力",
              class: "input input-bordered w-full bg-base-100/50 focus:bg-white",
              autocomplete: "off",
              data: {
                char_counter_target: "input",
                duplicate_checker_target: "arranger",
                autocomplete_target: "input",
                action: "input->char-counter#updateCount input->duplicate-checker#checkDuplicate input->autocomplete#onInput blur->autocomplete#onBlur keydown->autocomplete#onKeydown focus->char-counter#markAsTouched"
              } %>
        <ul class="absolute z-10 w-full bg-white border border-base-200 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto hidden"
            data-autocomplete-target="results"></ul>
        <div class="text-right text-sm text-neutral/60 mt-1">
          <span data-char-counter-target="counter">0</span> / <%= Song::ARRANGER_MAX_LENGTH %>文字
        </div>
      </div>

      <div class="flex items-center gap-2 ml-1 my-2 hidden" data-duplicate-checker-target="confirmation">
        <%= f.check_box :confirmation, class: "checkbox checkbox-sm checkbox-primary mt-0.5 rounded-md" %>
        <%= f.label :confirmation, "曲が登録されていないことを確認しました", class: "text-neutral/80 text-sm cursor-pointer select-none" %>
      </div>

      <div class="flex flex-col gap-4 pt-4">
        <%= f.submit "曲追加", class: "btn btn-primary w-full shadow-md hover:shadow-lg transition-all hover:-translate-y-0.5 rounded-full" %>
        <%= link_to "キャンセル",
                    songs_path,
                    class: "btn btn-outline w-full rounded-full px-8" %>
      </div>
    <% end %>
    </div>
  </div>
</div>
