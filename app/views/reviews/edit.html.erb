<div class="flex-1 px-4 py-8">
  <div class="max-w-7xl mx-auto">
    <div class="mb-8">
      <h2 class="text-3xl text-primary font-semibold mb-4">レビュー編集</h2>
      <p class="text-2xl text-neutral font-semibold mb-2"><%= @song.title %></p>
      <p class="text-xl text-neutral">作曲：<%= @song.composer || "－" %></p>
      <p class="text-xl text-neutral">編曲：<%= @song.arranger || "－" %></p>
    </div>

    <%= form_with model: [@song, @review], data: { controller: "review-form" } do |f| %>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- 左側: 評価フォーム -->
        <div class="space-y-6">
          <div class="bg-base-100 p-6 rounded-lg border border-base-300">
            <h3 class="text-xl font-semibold mb-6">各項目の評価</h3>

            <%= render "shared/error_message", object: f.object %>

            <%= render "rating_field",
              f: f,
              label: "テンポ",
              field: :tempo_rating,
              description: "テンポの安定性や正確性を評価してください" %>

            <%= render "rating_field",
              f: f,
              label: "運指技巧",
              field: :fingering_technique_rating,
              description: "運指の滑らかさや正確性を評価してください" %>

            <%= render "rating_field",
              f: f,
              label: "弾弦技巧",
              field: :plucking_technique_rating,
              description: "弾弦の技術や音色の美しさを評価してください" %>

            <%= render "rating_field",
              f: f,
              label: "表現力",
              field: :expression_rating,
              description: "音楽的表現力や感情表現を評価してください" %>

            <%= render "rating_field",
              f: f,
              label: "暗譜・構成理解",
              field: :memorization_rating,
              description: "暗譜の正確性や楽曲構成の理解度を評価してください" %>

            <!-- コメント -->
            <div class="mb-6">
              <%= f.label :summary, "コメント（任意）", class: "label font-semibold" %>
              <%= f.text_area :summary, rows: 6, class: "textarea textarea-bordered w-full resize-none", placeholder: "演奏についてのコメントを入力してください" %>
            </div>
          </div>
        </div>

        <!-- 右側: プレビューとガイドライン -->
        <div class="space-y-6">
          <!-- 評価プレビュー -->
          <div class="bg-base-100 p-6 rounded-lg border border-base-300">
            <h3 class="text-xl font-semibold mb-4">評価プレビュー</h3>
            <div class="bg-base-200 rounded-lg p-8 flex items-center justify-center min-h-[300px]">
              <canvas data-review-form-target="chart" class="max-w-full"></canvas>
            </div>
          </div>

          <!-- 評価ガイドライン -->
          <div class="bg-base-100 p-6 rounded-lg border border-base-300">
            <h3 class="text-xl font-semibold mb-4">評価ガイドライン</h3>
            <div class="space-y-2 text-sm">

              <% guidelines = [
                "ダミーテキスト",
                "ダミーテキスト",
                "ダミーテキスト",
                "ダミーテキスト",
                "ダミーテキスト"
              ] %>

              <% guidelines.each_with_index do |text, index| %>
                <div class="flex items-center gap-2">
                  <div class="rating rating-sm">
                    <% 5.times do |i| %>
                      <% if i == index %>
                        <div class="mask mask-star-2 bg-orange-400" aria-label="<%= "#{i + 1} star" %>" aria-current="true"></div>
                      <% else %>
                        <div class="mask mask-star-2 bg-orange-400" aria-label="<%= "#{i + 1} star" %>"></div>
                      <% end %>
                    <% end %>
                  </div>
                  <span class="text-sm">：<%= text %></span>
                </div>
              <% end %>

            </div>
          </div>
        </div>
      </div>

      <!-- ボタン -->
      <div class="flex justify-center gap-4 mt-8">
        <%= link_to "キャンセル", song_reviews_path(@song), class: "btn bg-neutral text-base-100 px-8" %>
        <%= f.submit "評価を更新する", class: "btn bg-primary text-base-100 px-8" %>
      </div>
    <% end %>
  </div>
</div>
