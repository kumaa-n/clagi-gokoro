<%= content_for(:title, t(".title")) %>

<div class="flex-1 px-4 py-8 md:py-12 lg:py-16">
  <div class="max-w-7xl mx-auto">
    <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-4 mb-6 md:mb-8">
      <%= render "song_header", song: @song, title: "レビュー詳細" %>
      <div class="flex gap-2 flex-shrink-0">
        <%= link_to song_reviews_path(@song), class: "btn btn-ghost text-primary" do %>
          <%= inline_svg_tag("back.svg", class: "fill-current") %>一覧へ
        <% end %>
        <% if user_signed_in? && current_user == @review.user %>
          <%= link_to "編集", edit_review_path(@review), class: "btn btn-primary text-base-100 px-6" %>
          <%= render "delete_modal", review: @review do %>
            <button data-action="auto-modal#show" class="btn btn-error text-base-100 px-6">削除</button>
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-4 mb-6 md:mb-8">
      <div>
        <p class="text-sm md:text-base text-primary">投稿者：<%= @review.user.name %></p>
        <p class="text-sm md:text-base text-primary">投稿日：<%= format_date(@review.created_at) %></p>
      </div>
      <div class="flex items-center gap-2">
        <span class="text-primary text-base md:text-lg">総合難易度：</span>
        <%= star_rating_display(@review.overall_rating, size: "sm") %>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 md:mb-8">
      <!-- 各項目の評価 -->
      <div class="card bg-base-100 border border-base-300">
        <div class="card-body">
          <h3 class="text-lg md:text-xl text-primary font-semibold mb-4">各項目の評価</h3>
          <% rating_display_data(@review).each do |item| %>
            <%= render "rating_item", label: item[:label], rating: item[:rating], description: item[:description], criteria: item[:criteria] %>
          <% end %>
        </div>
      </div>

      <div class="card bg-base-100 border border-base-300">
        <div class="card-body">
          <h3 class="text-lg md:text-xl text-primary font-semibold mb-4">評価プレビュー</h3>
          <div class="bg-base-200 rounded-lg p-8 flex items-center justify-center min-h-[300px]" data-controller="review-detail-chart">
            <canvas
              data-review-detail-chart-target="canvas"
              class="max-w-full"
              data-tempo="<%= @review.tempo_rating %>"
              data-fingering="<%= @review.fingering_technique_rating %>"
              data-plucking="<%= @review.plucking_technique_rating %>"
              data-expression="<%= @review.expression_rating %>"
              data-memorization="<%= @review.memorization_rating %>"
            ></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="card bg-base-100 border border-base-300 mb-6">
      <div class="card-body">
        <h3 class="text-lg md:text-xl text-primary font-semibold mb-4">投稿者コメント</h3>
        <p class="text-sm md:text-base text-primary whitespace-pre-wrap break-words"><%= @review.summary %></p>
      </div>
    </div>

    <div class="flex gap-3">
      <%= render "review_favorites/button", review: @review %>
    </div>
  </div>
</div>
